<!DOCTYPE html>
<html lang="ko">

<head>
    <style>
        * {
            text-align: center;
            background-color: black;
        }

        /* ê²Œì„íŒì˜ í…Œì´ë¸” ìŠ¤íƒ€ì¼ ì„¤ì • */
        #board {
            margin-left: auto;
            margin-right: auto;
            border-collapse: collapse;
        }

        /* ê° ì…€ì˜ ìŠ¤íƒ€ì¼ì„ ì„¤ì • */
        #board tr td {
            border-radius: 10px;
            background-color: #0078d4;
            width: 30px;
            height: 30px;
            text-align: center;
            font-size: 20px;
        }

        /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦´ ë•Œ ì…€ì˜ ìƒ‰ìƒì„ ë³€ê²½ */
        #board tr td:hover{
            background-color: lightblue;
            transition: background-color 0.5s ease;
        }

        /* í´ë¦­í•œ ì…€ì˜ ìŠ¤íƒ€ì¼ */
        #board tr td.clicked {
            background-color: #cccccc;
        }

        /* ì§€ë¢°ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì§€ë¢° ì•„ì´ì½˜ì„ í‘œì‹œ */
        #board tr td.mine.clicked::after {
            content: "ğŸ’£";
        }

        /* ê¹ƒë°œì„ ì„¤ì •í•œ ì…€ì— ê¹ƒë°œ ì•„ì´ì½˜ì„ í‘œì‹œ */
        #board tr td.flagged::after {
            content: "ğŸ´";
        }

        /* ìƒˆë¡œìš´ ê²Œì„ ìƒì„± ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .new{
            width: 200px;
            height: 40px;
            margin-top: 100px;
            background-color: lightblue;
            border: 3px solid lightskyblue;
            border-radius: 20px;
        }

        /* ë²„íŠ¼ì„ ë§ˆìš°ìŠ¤ë¡œ ì˜¬ë ¸ì„ ë•Œ ìƒ‰ìƒ ë³€í™” */
        .new:hover{
            border: 3px solid lightgreen;
            background-color: lightseagreen;
            transition: background-color 0.5 ease;
        }

        /* ë²„íŠ¼ì„ í´ë¦­í•  ë•Œ í¬ê¸° ë³€í™” */
        .new:active{
            transform: scale(0.9);
        }
    </style>
</head>

<body>
    <h1>ì§€ë¢°ì°¾ê¸°</h1>
    <!-- ê²Œì„íŒ í…Œì´ë¸” -->
    <table id="board"></table>
    <!-- ìƒˆë¡œìš´ ê²Œì„ ìƒì„± ë²„íŠ¼ -->
    <BUTTON onclick="genGrid();" class="new">ê²Œì„ ë‹¤ì‹œ ìƒì„±í•˜ê¸°</BUTTON>

    <script>
        const size = 8;  // ì§€ë¢°ì°¾ê¸° íŒì˜ í¬ê¸°
        const mineProbability = 0.2;  // ì§€ë¢°ê°€ ìƒì„±ë  í™•ë¥ 

        let minefield;  // ì§€ë¢° í•„ë“œë¥¼ ì €ì¥í•  ë³€ìˆ˜
        let revealedCount = 0;  // í”Œë ˆì´ì–´ê°€ ì˜¤í”ˆí•œ ì¹¸ì˜ ìˆ˜
        let totalMines = 0;  // ì´ ì§€ë¢°ì˜ ìˆ˜
        let flaggedMines = 0;  // ê¹ƒë°œë¡œ í‘œì‹œí•œ ì§€ë¢°ì˜ ìˆ˜
        const grid = document.getElementById("board");  // í…Œì´ë¸” ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°

        // ì§€ë¢°ì°¾ê¸° íŒì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
        function genGrid() {
            grid.innerHTML = "";  // í…Œì´ë¸” ì´ˆê¸°í™”
            minefield = [];
            revealedCount = 0;
            totalMines = 0;
            flaggedMines = 0;

            // í…Œì´ë¸”ì„ 8x8 í¬ê¸°ë¡œ ìƒì„±
            for (let i = 0; i < size; i++) {
                const row = grid.insertRow(i);
                const rowData = [];

                for (let j = 0; j < size; j++) {
                  const cell = row.insertCell(j);
                  cell.setAttribute("data-row", i);
                  cell.setAttribute("data-col", j);
                  cell.onclick = function () { clickBox(this); };  // ì™¼ìª½ í´ë¦­ ì‹œ ë™ì‘
                  cell.oncontextmenu = function (e) { e.preventDefault(); flagBox(this); };  // ì˜¤ë¥¸ìª½ í´ë¦­ ì‹œ ë™ì‘

                    const isMine = Math.random() < mineProbability;  // ë¬´ì‘ìœ„ë¡œ ì§€ë¢° ì„¤ì •
                    cell.setAttribute("mine", isMine ? "true" : "false");
                    rowData.push({
                        isMine: isMine,
                        revealed: false,
                        flagged: false
                    });

                    if (isMine) {
                        totalMines++;  // ì§€ë¢°ì˜ ì´ ê°œìˆ˜ ê³„ì‚°
                    }
                }
                minefield.push(rowData);
            }
        }

        // ì™¼ìª½ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function clickBox(cell) {
            const row = parseInt(cell.getAttribute("data-row"));
            const col = parseInt(cell.getAttribute("data-col"));

            // ì´ë¯¸ ì˜¤í”ˆí–ˆê±°ë‚˜ ê¹ƒë°œì´ í‘œì‹œëœ ê²½ìš° í´ë¦­í•˜ì§€ ì•ŠìŒ
            if (minefield[row][col].flagged || minefield[row][col].revealed) {
                return;
            }

            // ì§€ë¢°ë¥¼ í´ë¦­í•œ ê²½ìš°
            if (minefield[row][col].isMine) {
                cell.className = "mine clicked";
                revealMines();
                alert("ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");  // ê²Œì„ ì¢…ë£Œ ë©”ì‹œì§€
            } else {
                revealCell(row, col);  // ì•ˆì „í•œ ì¹¸ì„ í´ë¦­í•œ ê²½ìš°
                checkVictory();  // ìŠ¹ë¦¬ ì¡°ê±´ í™•ì¸
            }
        }

        // ì˜¤ë¥¸ìª½ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” ê¹ƒë°œ í‘œì‹œ í•¨ìˆ˜
        function flagBox(cell) {
            const row = parseInt(cell.getAttribute("data-row"));
            const col = parseInt(cell.getAttribute("data-col"));

            // ì´ë¯¸ ì˜¤í”ˆí•œ ì…€ì€ ê¹ƒë°œ í‘œì‹œ ë¶ˆê°€
            if (minefield[row][col].revealed) {
                return;
            }

            // ê¹ƒë°œì´ ì´ë¯¸ í‘œì‹œëœ ê²½ìš° ê¹ƒë°œ ì œê±°
            if (minefield[row][col].flagged) {
                cell.className = "";
                minefield[row][col].flagged = false;
                flaggedMines--;
            } else {
               cell.className = "flagged";
               minefield[row][col].flagged = true;
               flaggedMines++;
            }
        }

        // ë¹ˆ ì¹¸ ë˜ëŠ” ì§€ë¢°ê°€ ì•„ë‹Œ ì…€ì„ ì—´ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        function revealCell(row, col) {
            if (row < 0 || col < 0 || row >= size || col >= size || minefield[row][col].revealed || minefield[row][col].flagged) {
                return;
            }
            const cell = grid.rows[row].cells[col];
            const mineCount = countAdjacentMines(row, col);  // ì£¼ë³€ ì§€ë¢°ì˜ ìˆ˜ë¥¼ ê³„ì‚°

            minefield[row][col].revealed = true;
            revealedCount++;
            cell.className = "clicked";
            if (mineCount > 0) {
                cell.innerHTML = mineCount;  // ì£¼ë³€ ì§€ë¢° ìˆ˜ í‘œì‹œ
            } else {
                // ì£¼ë³€ ì…€ë“¤ë„ ìë™ìœ¼ë¡œ ì—´ë¦¼
                revealCell(row - 1, col);
                revealCell(row + 1, col);
                revealCell(row, col - 1);
                revealCell(row, col + 1);
                revealCell(row - 1, col - 1);
                revealCell(row - 1, col + 1);
                revealCell(row + 1, col - 1);
                revealCell(row + 1, col + 1);
            }
        }

        // ì£¼ë³€ 8ê°œì˜ ì…€ì— ì§€ë¢°ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function countAdjacentMines(row, col) {
            let mineCount = 0;

            for (let i = -1; i <= 1; i++) {
              for (let j = -1; j <= 1; j++) {
                 const newRow = row + i;
                 const newCol = col + j;

                 if (newRow >= 0 && newCol >= 0 && newRow < size && newCol < size) {
                   if (minefield[newRow][newCol].isMine) {
                      mineCount++;
                    }
                  }
              }
            }

            return mineCount;
        }

        // ëª¨ë“  ì§€ë¢°ë¥¼ ê³µê°œí•˜ëŠ” í•¨ìˆ˜
        function revealMines() {
          for (let i = 0; i < size; i++) {
            for (let j = 0; j < size; j++) {
              if (minefield[i][j].isMine) {
                grid.rows[i].cells[j].className = "mine clicked";
                }
            }
          }
        }

        // ìŠ¹ë¦¬ ì¡°ê±´ì„ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function checkVictory() {
          const totalCells = size * size;
          const nonMineCells = totalCells - totalMines;

          if (revealedCount === nonMineCells && flaggedMines === totalMines) {
             alert("ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¹ì‹ ì´ ì´ê²¼ìŠµë‹ˆë‹¤!");  // ìŠ¹ë¦¬ ë©”ì‹œì§€
              revealMines();
            }
        }

        // ê²Œì„ ì‹œì‘ ì‹œ ì´ˆê¸° ê·¸ë¦¬ë“œ ìƒì„±
        genGrid();
    </script>
</body>

</html>
